<?php
$filterCounts = $block->getFilterCounts();
$filterData = $block->getFilterData();

$logger = $block->getLogger();
$logger->info('Filter Counts in Template: ' . json_encode($filterCounts));
$logger->info('Filter Data in Template: ' . json_encode($filterData));
?>

<div class="sidebar sidebar-main">
    <div class="block filter">
        <div class="block-title filter-title">
            <strong>Shop By</strong>
        </div>
        <div class="block-content filter-content">
            <strong role="heading" aria-level="2" class="block-subtitle filter-subtitle">Shopping Options</strong>
            <dl class="filter-options" id="narrow-by-list">
                <?php 
                foreach ($filterData as $attributeCode => $options): 
                    $logger->info('Processing Attribute Code: ' . $attributeCode . ' with options: ' . json_encode($options));
                    if (!empty($options)): ?>
                        <dt role="heading" aria-level="3" class="filter-options-title">
                            <?= $escaper->escapeHtml($attributeCode) ?>
                        </dt>
                        <dd class="filter-options-content">
                            <ol class="items">
                                <?php foreach ($options as $optionId => $optionLabel): 
                                    $logger->info('Processing Option: ' . $optionLabel . ' for Attribute Code: ' . $attributeCode); ?>
                                    <li class="item">
                                        <span class="item-label"><?= $escaper->escapeHtml($optionLabel) ?></span>
                                        <span class="count">
                                            <?= isset($filterCounts[$attributeCode][$optionId]) ? $escaper->escapeHtml($filterCounts[$attributeCode][$optionId]) : '0' ?>
                                            <span class="filter-count-label">items</span>
                                        </span>
                                    </li>
                                <?php endforeach; ?>
                            </ol>
                        </dd>
                    <?php endif; 
                endforeach; ?>
            </dl>
        </div>
    </div>
</div>
