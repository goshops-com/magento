<?php
$filterDataCombined = $block->getRequest()->getParam('filter_data_combined');
$logger = $block->getLogger();
$logger->info('Filter Data Combined in Template: ' . json_encode($filterDataCombined));
?>

<div class="sidebar sidebar-main" style="width: 100%;">
    <div class="block filter">
        <div class="block-title filter-title">
            <strong>Shop By</strong>
        </div>
        <div class="block-content filter-content">
            <strong role="heading" aria-level="2" class="block-subtitle filter-subtitle">Shopping Options</strong>
            <dl class="filter-options" id="narrow-by-list">
                <?php foreach ($filterDataCombined as $attributeCode => $options): ?>
                    <?php if (!empty($options)): ?>
                        <dt role="heading" aria-level="3" class="filter-options-title">
                            <a href="javascript:void(0);" class="toggle-section"><?= $escaper->escapeHtml($attributeCode) ?></a>
                        </dt>
                        <dd class="filter-options-content" style="display: none;">
                            <ol class="items">
                                <?php foreach ($options as $optionId => $optionData): ?>
                                    <li class="item">
                                        <span class="item-label"><?= $escaper->escapeHtml($optionData['label']) ?></span>
                                        <span class="count">
                                            <?= $optionData['count'] ?>
                                            <span class="filter-count-label">items</span>
                                        </span>
                                    </li>
                                <?php endforeach; ?>
                            </ol>
                        </dd>
                    <?php endif; ?>
                <?php endforeach; ?>
            </dl>
        </div>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    var toggles = document.querySelectorAll('.toggle-section');
    toggles.forEach(function(toggle) {
        toggle.addEventListener('click', function() {
            var content = this.parentElement.nextElementSibling;
            if (content.style.display === 'none' || content.style.display === '') {
                content.style.display = 'block';
            } else {
                content.style.display = 'none';
            }
        });
    });
});
</script>

<style>
.toggle-section {
    cursor: pointer;
    text-decoration: none;
    color: #000;
}

.toggle-section::before {
    content: '\25B6'; /* Right-pointing triangle */
    display: inline-block;
    margin-right: 5px;
}

.filter-options-title[aria-expanded="true"] .toggle-section::before {
    content: '\25BC'; /* Down-pointing triangle */
}

.filter-options-title[aria-expanded="true"] + .filter-options-content {
    display: block;
}
</style>
